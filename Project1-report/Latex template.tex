%Template by Mark Jervelund - D1 - 2015 - mjerv15@student.sdu.dk

\documentclass[a4paper,10pt,titlepage]{report}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{graphicx}
\usepackage{fancyhdr}
\usepackage{lastpage}
\usepackage{listings}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage[document]{ragged2e}
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{datenumber}
\usepackage{venndiagram}
\usepackage{chngcntr}
\setdatetoday
\addtocounter{datenumber}{0} %date for dilierry standard is today
\setdatebynumber{\thedatenumber}
\date{}
\setcounter{secnumdepth}{0}
\pagestyle{fancy}
\fancyhf{}

\newcommand{\Z}{\mathbb{Z}}
\lhead{Database Management Systems (DM556))}
\rhead{Mark Jervelund (Mjerv15) Troels Petersen (trpet15)}
\rfoot{Page  \thepage \, of \pageref{LastPage}}
\counterwithin*{equation}{section}

\lstset{
  numbers=left,
  stepnumber=5,    
  firstnumber=1,
  numberfirstline=true
  frame=single,
  breaklines=true,
  postbreak=\raisebox{0ex}[0ex][0ex]{\ensuremath{\color{red}\hookrightarrow\space}}
}

\begin{document}
\begin{titlepage}
\centering
    \vspace*{9\baselineskip}
    \huge
    \bfseries
    Project 1\\
    
    \normalfont 
	\huge    
    Database Management Systems (DM556)  \\[4\baselineskip]
    \normalfont
	\includegraphics[scale=1.5]{SDU_Logo}
    \vfill\ 
    Mark Jervelund (Mjerv15) Troels Petersen (trpet15)
    \vspace{5mm}
    IMADA \\
    \textbf{\datedate} \\[2\baselineskip]
\end{titlepage}
%\renewcommand{\thepage}{\roman{page}}% Roman numerals for page counter
%\tableofcontents

%\newpage
\setcounter{page}{1}
\renewcommand{\thepage}{\arabic{page}}

\lstset{language=Java}          % Set your language (you can change the language for each code-block optionally)
\section{Overall Status}
The overall status of of project is that we hit some bugs we that don't understand and are handing in this part of the project so we can get feedback and fix the current issues when we hand it Project 3.
\section{Division of Labor}
We worked on the project either sitting together at the university or at home remotely working together and spliting tasks when possible.
\subsection{Specification}
We were tasked with implementing the following functions for the bufmgr.java\\

freePage, pinPage, unpinPage, flushPage, flushAllPages, getNumBuffers, getNumUnpinned and pick victim. \\

freePage should deallocate a page from disk.\\

Pinpage should pin a page by incrementing the pincnt by 1, or by loading it into the bufferpool if it isnt in the bufferpool already.\\

Unpinpage should unpin a page, flush it to disk if its dirty and reduce the pincount by 1.\\

Flushpage should save a page to disk if dirty.\\

Flushpages should write all pages to disk if they're dirty.\\

getNumBuffers gets the amount of buffers.\\

getNumUnpinned gets the number of unpinned pages.\\

Pickvictim gets the index for the first unpinned page, and returns -1 if all pages in the pool are pinned.

%\subsection{Design}
%
%Flushpages was implementing using Flushpage as they're almost %doing the same and this reduces the amount of dubplicate code. 

\subsection{Implementation}
Freepage First checks if the page is pinned. If its not, it then deallocates the page from disk.
\lstinputlisting[firstline=103,lastline=110,frame=single]{../dm556-project1/bufmgr/BufMgr.java}
\vspace{10mm}
pinpage
\lstinputlisting[firstline=100,lastline=110,frame=single]{../dm556-project1/bufmgr/BufMgr.java}
\vspace{10mm}
Pickvictim is implemented to return the index for the first element with pincnt 0. and if all elements are in use it returns -1 to indicate this.
\lstinputlisting[firstline=37,lastline=46, frame=single]{../dm556-project1/bufmgr/Clock.java}

\subsection{Testing}
From the testing we've done the programs gets into a neverending loop pin/unpin loop at SystemCatalog = new Catalog(false) in Minibase.java line 79 (my file with some print statements for debugging)
\subsection{Conclusion}



\section{Appendix}
Pickvictim
\lstinputlisting[firstline=37,lastline=46, frame=single]{../dm556-project1/bufmgr/Clock.java}

bufmgr.java
\lstinputlisting[frame=single]{../dm556-project1/bufmgr/BufMgr.java}
\end{document}
